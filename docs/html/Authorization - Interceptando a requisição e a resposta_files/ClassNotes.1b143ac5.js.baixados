var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ClassNotes=function(){function t(e){_classCallCheck(this,t),this.textArea=$("#courseNotebook-text"),this.content=$(".class-notes"),this.$task=$(".task"),this.$saveButton=$(".class-notes-save-button"),this.$savedText=$(".class-notes-saved-text"),this.endpoint="/course/note/"+this.$task.data("course-code"),this.fetchNote(e),this.originalText="",this._isSaving=!1}return _createClass(t,[{key:"saveNotes",value:function(){var t=this;if(this.textArea.val()!=this.originalText&&!this._isSaving){this.$saveButton.parent().addClass("class-notes-save-button--saving"),this.$saveButton.get(0).innerHTML=this.$saveButton.data("savingText"),this._isSaving=!0;var e=setTimeout(function(){return t._isSaving=!1},700);$.post(this.endpoint,{text:this.textArea.val(),highlightedText:this.textArea.val()}).success(function(){t.$saveButton.parent().removeClass("class-notes-save-button--saving"),t.$saveButton.get(0).innerHTML=t.$saveButton.data("saveText"),t.$savedText.toggle(),setTimeout(function(){return t.toggleSaveText()},1200),t.originalText=t.textArea.val(),t._isSaving=!1,clearTimeout(e)}).fail(function(){t._isSaving=!1,clearTimeout(e)})}}},{key:"toggleSaveText",value:function(){var t=this.$savedText.attr("aria-hidden");this.$savedText.attr("aria-hidden",!t),this.$savedText.toggle()}},{key:"debounce",value:function(t){return function(){var e=this,s=arguments;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.apply(e,s)},300)}.bind(this)}},{key:"fetchNote",value:function(t){var e=this;$.get(this.endpoint).success(function(s){e.originalText=s.text.raw,e.textArea.val(e.originalText),t&&e.$task.toggleClass("class-notes--active")})}},{key:"refreshListeners",value:function(){var t=this;this.textArea.get(0)&&(this.textArea.on("change",this.debounce(this.saveNotes)),window.onunload=function(){return t.saveNotes()},$(".class-notes-close-button").on("click",function(){return t.toggleContent()}),$(".class-notes-button").on("click",function(){return t.toggleContent()}),this.$saveButton.on("click",function(){return t.saveNotes()}))}},{key:"toggleContent",value:function(){this.$task.toggleClass("class-notes--active"),this.$task.hasClass("class-notes--active")&&this.saveNotes()}}]),t}();