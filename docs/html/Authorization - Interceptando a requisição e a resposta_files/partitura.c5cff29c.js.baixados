var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var FullScreenHandler=function(){function e(t){_classCallCheck(this,e),this.painel=this.createPanel(),this.imgSources=t.toArray().map(function(e){return e.src})}return _createClass(e,[{key:"toggleFullScreen",value:function(e){var t=this.painel.get(0);this.painel.show(),this.setImageSource(e),document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(this.exitFullScreen(),document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}},{key:"setImageSource",value:function(e){this.painel.show(),this.painel.find("#full-screen__image").attr("src",this.imgSources[e]),this.active=e}},{key:"exitFullScreen",value:function(){this.active=null,this.painel.hide()}},{key:"createPreviousButton",value:function(){var e=this;return $('<button  class="button buttonAction partitura-download">Anterior</button> ').on("click",function(t){return e.previousSheet()})}},{key:"createNextButton",value:function(){var e=this;return $('<button  class="button buttonAction partitura-download">Pr√≥ximo</button> ').on("click",function(t){return e.nextSheet()})}},{key:"createExitButton",value:function(){var e=this;return $('<button  class="button buttonAction partitura-download">Sair</button> ').on("click",function(t){return e.toggleFullScreen()})}},{key:"createPanel",value:function(){return $('<div class="full-screen__panel">\n\t\t\t\t<img id="full-screen__image" class="full-screen__image" src="" alt="">\n\t\t\t\t<div class="full-screen__actions">\n\t\t\t\t</div> \n\t\t\t</div>').hide().insertAfter(".task").find(".full-screen__actions").append(this.createPreviousButton()).append(this.createExitButton()).append(this.createNextButton()),$(".full-screen__panel")}},{key:"isInFullScreen",value:function(){return void 0!=document.webkitFullscreenElement||void 0!=document.mozFullScreenElement||void 0!=document.msFullscreenElement}},{key:"refreshListener",value:function(){var e=this;$("body").on("keyup",function(t){e.isInFullScreen()&&("37"==t.which||"40"==t.which?e.previousSheet():"38"==t.which||"39"==t.which?e.nextSheet():"27"==t.which&&e.toggleFullScreen())}),document.addEventListener("fullscreenchange",function(t){return!e.isInFullScreen()&&e.exitFullScreen()}),document.addEventListener("mozfullscreenchange",function(t){return!e.isInFullScreen()&&e.exitFullScreen()}),document.addEventListener("webkitfullscreenchange",function(t){return!e.isInFullScreen()&&e.exitFullScreen()})}},{key:"nextSheet",value:function(){this.active=(this.active+1)%this.imgSources.length,this.setImageSource(this.active)}},{key:"previousSheet",value:function(){this.active=Math.abs((this.active-1)%this.imgSources.length),this.setImageSource(this.active)}}]),e}(),MusicSheet=function(){function e(){var t=this;_classCallCheck(this,e),this.partituras=$(".partitura"),this.elements={musicSheets:function(){return t.partituras}},this.taskTitle=$(".task-body-header-title-text").text(),this.settings=$(".settings-box-list"),this.fullScreenHandler=new FullScreenHandler(this.partituras),this.fullScreenHandler.refreshListener()}return _createClass(e,[{key:"init",value:function(){this.setupListeners(),this.createDownloadButtons(),this.partituras.length>1&&this.createDownloadsSettings()}},{key:"createDownloadButtons",value:function(){var e=this;this.elements.musicSheets().each(function(t,n){var i=n.src,a=n.alt||e.taskTitle+" - partitura "+(t+1);e.isMobile()?$(n).after("<div class=\"partitura-download__wrapper\"><a class='button buttonAction partitura-download' href='"+i+"' download='"+a+"' title='"+a+"' target='_blank'>Download</a></div>"):e.toDataURL(i,function(i){var l="<button class='button buttonAction partitura-download' id='sheet-view-"+t+"' title='"+a+"'>Visualizar</button>",r="<a class='button buttonAction partitura-download' href='"+i+"' download='"+a+"' title='"+a+"' target='_blank'>Download</a>";$(n).after('<div class="partitura-download__wrapper">'+r+" "+l+"</div>"),$("#sheet-view-"+t).on("click",function(n){return e.fullScreenHandler.toggleFullScreen(t)})})})}},{key:"createDownloadsSettings",value:function(){var e=this;$('<li class="settings-box-item settings-box-item-partituras"><button class="download-partituras">Baixar todas as imagens</button></li>').on("click",function(t){return e.downloads()}).appendTo(this.settings)}},{key:"toDataURL",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpg",i=new Image;i.crossOrigin="Anonymous",i.onload=function(){var e=document.createElement("CANVAS");e.height=this.naturalHeight,e.width=this.naturalWidth,e.getContext("2d").drawImage(this,0,0);var i=e.toDataURL(n);t(i)},i.src=e+"?"+Math.random()}},{key:"downloads",value:function(){$("a.partitura-download").each(function(){$(this)[0].click()})}},{key:"isMobile",value:function(){return 0==document.location.pathname.indexOf("/mobile/")}},{key:"setupListeners",value:function(){var e=this;this.elements.musicSheets().each(function(t,n){return $(n).on("click",function(n){return e.fullScreenHandler.toggleFullScreen(t)})})}}]),e}();(new MusicSheet).init();